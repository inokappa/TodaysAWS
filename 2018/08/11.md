# 2018/08/11 今日の AWS

## 今日の AWS ~ AWS 認定デベロッパー – アソシエイトレベルサンプル試験を解く (1) ~

公開されている[サンプル試験問題](https://d1.awsstatic.com/training-and-certification/docs-dev-associate/AWS%20Certified_Developer_associate_examsample_JP.pdf)を解く. なぜ, その答えになるのかをちゃんと理解する必要がある.

### Q1. SQS の仕様について

#### 設問

次の文のうち、SQS について正しく述べているものはどれですか?

```
A. メッセージは 1 回だけ配信され、先入れ先出しの順序で配信される。
B. メッセージは 1 回だけ配信され、配信順序は決まっていない。
C. メッセージは 1 回以上配信され、先入れ先出しの順序で配信される。
D. メッセージは 1 回以上配信され、配信順序は決まっていない。
```

#### 正答

* D (メッセージは 1 回以上配信され, 配信順序は決まっていない.)

#### メモ

* [AWS Black Belt Tech シリーズ 2016 - Amazon SQS / Amazon SNS](https://www.slideshare.net/AmazonWebServicesJapan/aws-black-belt-tech-amazon-sqs-amazon-sns)
* SQS で利用する識別子
    * Queue URL
    * Message ID
    * Receipt Handle (受信ハンドル)
        * 同一メッセージでも, 受信ハンドルは異なるので, メッセージの削除の際は最新の受信ハンドルを用いる
* SQS のコスト
    * 毎月 100 万キューイングまでは無料
    * 同一リージョン内での SQS と EC2 インスタンスのデータ転送は無料
* メッセージは削除しない限りは複数回受信が可能, また, 受信の順番は送信の順番とは異なる場合がある (配信の順序は決まっていない)
    * 順序を保証しなければいけない場合, アプリケーションの実装で頑張る必要がある
    * 一部のリージョンでは FIFO キューという送受信の順序が同じキューも利用可能

### Q2. AMI の仕様について

#### 設問

EC2 インスタンスは Amazon マシンイメージ（AMI）から起動されます。次のうち、パブリック AMI について当てはまるものはどれですか ?

```
A. そこの AWS リージョンであっても EC2 インスタンスを起動するために使用できる。
B. その AMI が格納されている国で EC2 インスタンスを起動するためにのみ使用できる。
C. その AMI が格納されている AWS リージョンで EC2 インスタンスを起動するためにのみ使用できる。
D. その AMI が格納されている AWS アベイラビリティーゾーンで EC2 インスタンスを起動するためにのみ使用できる。
```

#### 正答

* C (その AMI が格納されている AWS リージョンで EC2 インスタンスを起動するためのみ使用出来る.)

#### メモ

* Amazon マシンイメージの略
* パブリック AMI については, リージョン毎に AMI が存在する

### Q3. 引き続き, SQS の仕様

#### 設問

... SQS キューからタスクを処理して実行するバックエンドインスタンスは、キューを可能な限り頻繁にポーリングして、処理を早く行えるようにしています。しかし短い周期でのポーリングによって、処理すべきタスクがない空のレスポンスが返り CPU が無駄に消費される可能性があります。空のレスポンスの数を減らすには、どうすればよいですか?

```
A. キューの VisibilityTimeout 属性を 20 秒に設定する。
B. キューの ReceiveMessageWaitTimeSeconds 属性を 20 秒に設定する。
C. キューの MessageRetentionPeriod 属性を 20 秒に設定する。
D. メッセージの DelaySeconds パラメータを 20 秒に設定する。
```

#### 正答

* B (キューの ReceiveMessageWaitTimeSeconds 属性を 20 秒に設定する)

#### メモ

* ReceiveMessageWaitTimeSeconds (いわゆるロングポーリング) を設定する
* ReceiveMessageWaitTimeSeconds とは
    * 返信するメッセージがない場合, 偽の空のレスポンスを排除して空のレスポンスの数を減らすことで, SQS の使用コストを削減する
* VisibilityTimeout とは
    * 複数の consumer が稼働している場合, 1 つの consumer が受信した後, 他の consumer には一時的 (デフォルトは 30 秒) メッセージを見せない機能
    * consumer1 が処理に失敗しても, 他の consumer で処理が継続出来る
* MessageRetentionPeriod
    * SQS がメッセージを保持する秒数
    * デフォルト値は 345600 秒 (4 日)
* DelaySeconds
    * 遅延キュー
    * キューへの新しいメッセージの配信を数秒延期することが出来る
    * デフォルト値は 0 秒

ﾌﾑﾌﾑ.
