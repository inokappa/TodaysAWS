# 2018/08/29 今日の AWS

## 今日の AWS ~ AWS 認定 SysOps アドミニストレーター – アソシエイトレベルサンプル試験を解く (2) ~

公開されている[サンプル試験問題](https://d1.awsstatic.com/training-and-certification/docs-sysops-associate/AWS%20Certified%20SysOps%20-%20Associate_Exam%20Sample_v1_FINALJP.pdf)を解く. なぜ, その答えになるのかをちゃんと理解する必要がある. 

### Q4. IAM ポリシー

#### 設問

次の IAM ポリシーについて質問に答えてください.

```json
{
  "Version":"2012‐10‐17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:Get*", "s3:List*"
        ],
      "Resource": "*"
    },
    {
      "Effect": "Allow",
      "Action":"s3:PutObject",
      "Resource": "arn:aws:s3:::corporate_bucket/*"
    }
  ]
}
```

この IAM ポリシーでは何が許可されますか?（3 つの回答を選択してください）

```
A. アカウントが所有するすべての S3 バケットからオブジェクトを読み取ることができる。
B. 'corporate_bucket' というバケットにオブジェクトを書き込むことができる。
C. 'corporate_bucket' というバケットのアクセス権を変更できる。
D. 'corporate_bucket' というバケットのオブジェクトを読み取ることができるが、バケットのオブジェクトをリストすることはできない。
E. 'corporate_bucket' というバケットからオブジェクトを読み取ることができる。
```

#### 解答

A. アカウントが所有するすべての S3 バケットからオブジェクトを読み取ることができる。
B. 'corporate_bucket' というバケットにオブジェクトを書き込むことができる。
E. 'corporate_bucket' というバケットからオブジェクトを読み取ることができる。


#### メモ

```json
    {
      "Effect": "Allow",
      "Action": [
        "s3:Get*", "s3:List*"
        ],
      "Resource": "*"
    },
```

こやつで, アカウントが所有する全ての S3 バケットのオブジェクト読み取りを許可している.

```json
    {
      "Effect": "Allow",
      "Action":"s3:PutObject",
      "Resource": "arn:aws:s3:::corporate_bucket/*"
    }
```

こやつで, corporate_bucket への書き込みを許可している.

### Q5. ストレージ

#### 設問

ブロックサイズが 4KB のデータを秒間 100,000 回 以上のランダムに読み取る必要がある NoSQL データベースに適切なストレージソリューションを選定する作業を任されました. この要件を満たす EC2 オプションはどれですか?

```
A. EBS プロビジョンド IOPS  
B. SSD インスタンスストア  
C. EBS 最適化インスタンス
D. RAID 1+0 で設定されたハイストレージインスタンス
```

#### 解答

B. SSD インスタンスストア  

#### メモ

* https://www.slideshare.net/AmazonWebServicesJapan/aws-instance-store-e
* インスタンスストアは
    * EC2 物理ホストのローカルディスクなので, スループットは EBS スループットに依存しない
    * stop で消えるが, reboot であればデータは消えない
    * Read 最大 40 万 IOPS, Read/Write 最大 35 万 IOPS (https://media.amazonwebservices.com/jp/summit2015/docs/TA-06-Tokyo-Summit-2015.pdf)
* 高速にデータにアクセス必要がある場合には, EBS ではなく, SSD のインスタンスストアを利用する
* 要件として `ブロックサイズが 4KB のデータを秒間 100,000 回 以上` だと SSD のインスタンスストアを選択する

### Q6. VPC サブネット間の疎通

#### 設問

インスタンス A とインスタンス B は、VPC の 2 つの異なるサブネット A と B において実行されています。 インスタンス A からインスタンス B に ping を行っても応答がありません. この原因として考えられる 2 つの理由は何ですか? 2 つ選択してください.

```
A. サブネット A のルーティングテーブルに、サブネット B へのターゲットルートがない
B. インスタンス B にアタッチされたセキュリティグループは、インバウンド ICMP トラフィックを許可しない
C. インスタンス A の IAM ロールにリンクされたポリシーが正しく設定されていない
D. サブネット B の NACL は、アウトバウンド ICMP トラフィックを許可しない
```

#### 解答

B. インスタンス B にアタッチされたセキュリティグループは、インバウンド ICMP トラフィックを許可しない
D. サブネット B の NACL は、アウトバウンド ICMP トラフィックを許可しない

#### メモ

* セキュリティグループはインスタンス単位で定義出来, デフォルトで全てのトラフィックを許可しない
* Network ACL はステートレスである為, 戻りのトラフィックについても明示的に許可する必要がある

以下, セキュリティグループと Network ACL の違い.

| | **セキュリティグループ** | **ネットワーク ACL** |
|:---|:---|:---|
| 適用範囲 | インスタンスレベルで動作する | サブネットレベルで動作する |
| ルールの定義 | 許可のみを設定する | 許可と拒否を設定する |
| 適用トラフィック | ステートフル (返りのトラフィックは自動的に許可) | ステートレス (返りのトラフィックは明示的に許可が必要) |
| 評価 | トラフィックを許可するかどうかを決める前に,すべてのルールを評価する | トラフィックを許可するかどうかを決めるときに, 順番にルールを処理する |

http://blog.takuros.net/entry/20131217/1387356888 より引用させて頂いた. 有難うございます.

ﾌﾑﾌﾑ.
