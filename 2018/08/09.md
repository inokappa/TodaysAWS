# 2018/08/09 今日の AWS

## 今日の AWS ~ コンピューティング ~

### EC2

* EC2 インスタンスは AZ サービス
* インスタンスタイプ
    * 汎用 (t2, m3, m4)
    * コンピューティングの最適化 (c3, c4)
    * GPU (g2)
    * メモリ最適化 (r3)
    * ストレージ最適化 (i2. d2)
* ユーザーデータ
    * OS の起動スクリプトのようなもの
* メタデータ
    * インスタンス ID や IP アドレス, ホスト名等の EC2 インスタンス自身に関するデータ
* ストレージ
    * EBS
    * インスタンスストア

### EC2 のライフサイクル

* ライフサイクル
    * pending
    * running
    * rebooting
    * stopping
    * shutting-down
    * stopped
    * terminated
* ステータスチェック
    * System Status Check (インフラストラクチャ (H/W, ハイパーバイザ) のチェック)
    * Instance Status Check (OS のチェック)
* オンデマンドインスタンスの課金
    * running になった時点で課金が発生, stopped 又は terminated になるまで発生

### EBS とインスタンスストア

| | **EBS** | **インスタンスストア** |
|:---|:---|:---|
| データ特性 | 不揮発性 (永続化) | 揮発性 |
| 性能 | 数百 ~ 20,000 IOPS | 最大 300,000 IOPS |
| 価格 | GB 課金 | 無料 |

EC2 には, EBS-backend インスタンスと, Instance store-backend (S3-backend) インスタンスの 2 タイプが存在する. 両者の違いは以下の通り.

* EBS-backend インスタンスは停止と起動, 再起動, 削除が可能
* Instance store-backend (S3-backend) インスタンスは再起動と, 削除, 尚, **停止は出来ない**

### EBS のタイプ

* General Purepose SSD (gp2)
    * 1GB ~ 16TB
    * 3IOPS/GB のベースパフォーマンス, 最大 10,000IOPS, ベースパフォーマンスが 3,000IOPS 未満の場合, 3,000IOPS までバースト機能
    * 容量課金
    * 一般的な利用 (汎用)
* Provisioned IOPS SSD (io1)
    * 4GB ~ 16TB
    * 容量あたり 50 IOPS を指定可能, 最大 20,000IOPS (最新だと, 最大 32,000 IOPS)
    * 容量 + 指定した IOPS 課金
    * 10,000 IOPS を超える性能が求められるアプリケーション, データベース等で利用
* スループット最適化 HDD (st1)
* コールド HDD (sc1)
* Magnetic
    * 1GB ~ 1TB
    * 平均 100 IOPS
    * 容量 + 発生した IO 数
    * IO があまり発生せず, コストが重視される構成で利用

Provisioned IOPS SSD で, EBS ディスク性能を高めることが出来るが, 通常の EC2 インスタンスでは, 通常のネットワーク帯域と EBS 用のネットワーク帯域が共有されている為, 十分に性能を引き出すことが出来ないが, **EBS 最適化インスタンス**を利用することで EBS 専用の帯域が確保される為, EBS の I/O が安定する. Provisioned IOPS SSD では, EBS の高い I/O 性能を活かす為にも, EBS 最適化インスタンスの利用が推奨される. (インスタンスタイプが大きい程, 使える帯域が大きい)

### EBS スナップショット

* 任意のタイミングでスナップショットを作成することが出来る
* スナップショットは S3 に保存される
* スナップショットは圧縮され, 差分のデータのみが保存される為, 容量を抑えることが出来る (圧縮後の容量に対して課金される)
* データの整合性を保つ為にディスク I/O を停止する必要があり, 対象の EBS ボリュームをアンマウントしてからスナップショットを取得することが推奨されている
* 取得開始時点の EBS ボリューム内のデータをキャプチャして, それ以降の書き込みはキャプチャ対象外
* 復元はスナップショットの元となったボリュームサイズよりも大きなディスクサイズを指定して復元することが出来る
* EBS ボリュームは AZ サービスであり, 同一 AZ 内の EC2 のみにアタッチすることが出来る
* リージョンをまたぎたい場合には, スナップショットを利用して別リージョンにコピーして EBS ボリュームを復元する 

### プレイスメントグループ

* 単一の AZ に**プレイスメントグループ** を作成すると **EC2 間のネットワーク接続を高速化**することが出来る

### Dedicated インスタンス

* EC2 インスタンスを起動する物理ホストに, 別のアカウントの EC2 インスタンスが起動しないことを保証する
* EC2 インスタンスの利用料金に加えて, リージョン毎の専有料金が発生する
