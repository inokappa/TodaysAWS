# 2018/08/08 今日の AWS

## 今日の AWS ~ VPC ~

### VPC

* Virtual Private Network
    * 10.0.0.0/16
    * 172.16.0.0/16
    * 192.168.0.0/16
* サブネット
    * 配置するサーバーの役割に応じて作成するのが一般的
* ゲートウェイ
    * インターネットへの出入り口 (IGW)
    * オンプレと VPN や専用線で通信する為の出入り口 (VGW)
* ルートテーブル
    * サブネット毎にインターネットアクセスを許可, 不許可の制限をかけることが出来る
    * IGW が定義されているルートテーブルがアタッチされている場合, パブリックサブネットとなる
    * VPC 内の通信はルートテーブルでは制御出来ない
* NAT インスタンス
    * プライベートサブネットからインターネットにアクセスする為に利用する
    * 「送信元 / 送信先チェック」を無効化する

### EC2 インスタンスの IP アドレス

* Public IP
* Elastic IP

### セキュリティグループとネットワーク ACL

#### セキュリティグループ

* セキュリティグループは EC2 や ELB, RDS 等のインスタンス毎のファイヤーウォール
* デフォルトでアウトバウントはフルオープン
* ステートフル (インバウンドで許可していた受信トラフィックの戻りのトラフィックは暗黙的に許可される)

### ネットワーク ACL

* サブネット毎のファイヤーウォール
* インバウンド, アウトバウントのアクセス制御が必要, 優先順位をつけて設定する
* ステートレス

### VPC ピア接続

* 2 つの VPC を接続する昨日
* プライベート IP 同士で通信を行う
* 双方の VPC に PCX というゲートウェイ相当のインターフェースが作成され, これをルートテーブルの送信先ターゲットとして設定する
* 制約
    * 接続する VPC は同一リージョンに存在していること (リージョンを跨げない)
    * プライベートネットワークアドレス空間は重複してはいけない
    * 1 対 1 の接続となる (VPC A と VPC B, VPC B と VPC C, VPC A と VPC C という感じで, 個別にピア接続する必要がある)
