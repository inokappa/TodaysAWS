# 2018/09/01 今日の AWS

## 今日の AWS ~ Trusted Advisor についてざっくりメモ ~

### Trusted Adivisor とは

* 環境を最適化するベストプラクティスを提供する
* ベストプラクティスは以下のようなカテゴリに分類される
    * コスト最適化
    * パフォーマンス
    * セキュリティ
    * フォールトトレランス
    * サービス制限

### コスト最適化

使われていないリソースを検出する, 利用状況を分析してコスト削減が期待出来る割引プランをおすすめする. 例えば, 以下のような感じ.

* リザーブドインスタンスの最適化
* アイドル状態の RDS インスタンス
* 使用率の低い EC2 インスタンス
    * 以下の条件を満たすインスタンスが 14 日間稼働している場合に警告 (黄) を表示
        * 1 日の CPU 使用率が 10% 以下
        * 且つ, Network I/O が 5MB 以下である日が 4 日以上ある
* 関連付けられていない EIP

### パフォーマンス

パフォーマンス低下につながる使い方をしているかどうかをチェックする. もっと効率の良い AWS の機能を使う余地がある場合にお知らせ.

* EC2 EBS のスループット最適化
* EC2 インスタンスセキュリティグループルールの増大
    * 1 つの EC2 インスタンスに 50 以上のセキュリティグループルールが紐付いている場合に警告 (黄) を表示
* 使用率の高い EC2 インスタンス
    * 以下の条件を満たすインスタンスが 14 日間稼働している場合に警告 (黄) を表示
        * 1 日の CPU 使用率が 90% 以上が 4 日以上ある
* 利用率が高すぎる EBS マグネティックボリューム

### セキュリティ

セキュリティリスクのある設定になっていないかどうかをチェックする. 現在よりもセキュリティが高められる推奨構成があれば, それをおすすめする.

* セキュリティグループ
    * 0.0.0.0/0 を検出
    * 25, 80, 443, 465 は除外
    * FTP 等がオープンになっているとエラー (赤), SSH 等は警告 (黄)
* CloudTrail ロギング
* EBS パブリックスナップショット
* IAM アクセスキーローテーション
    * 一定期間毎にキーをローテーションするように推奨されている
    * 90 日以上ローテーションされていない場合には警告 (黄)
    * 2 年以上ローテーションされていない場合にはエラー (赤)
* ルートアカウントの MFA
* 公開されたアクセスキー
    * うっかり公開されてしまったアクセスキーの有無をチェック
    * 公開していたら警告 (黄)
    * 漏洩が疑われる場合にはエラー (赤)

### フォールトトレランス

バックアップをちゃんとやっているか, AWS の機能を利用して冗長構成が取れているか等をチェックする.

* Load Balancer の最適化
    * 単一 AZ でしかロードバランサが有効化されていない
    * ロードバランサが有効化されている AZ でインスタンスが起動していない
    * AZ 間でインスタンス数が均等になっていない
    * CLB のみ対応
* RDS の Multi-AZ
    * 可用性を高める為に Multi-AZ になっているか
* Route53 フェイルオーバーのリソースレコードセット
* Directo Connect 接続の冗長性
* EBS のスナップショット

### サービス制限

AWS の各サービスにおいて, アカウント毎に利用可能なリソースに制限をかけている.

* ほとんどの制限はリージョン毎に独立している
* AWS 全体の可用性を担保する為
* 新規顧客の意図しない課金を防ぐ為

サービス制限の一部 (39 項目) に対して, 現在の利用値と制限の差分をチェックする.

* 制限の 80% になったら警告 (黄)
* 制限の 100% になったらエラー (赤)

Trusted Adovisor 使ったことないなあ.

ﾌﾑﾌﾑ.
